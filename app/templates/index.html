<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NBA Player Stats Projections</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background: #f5f1e8;
            color: #2c2c2c;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            font-size: 14px;
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #1e3a8a 0%, #2563eb 100%);
            padding: 24px 0;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-section h1 {
            font-size: 28px;
            font-weight: 900;
            color: #fff;
            margin-bottom: 4px;
            letter-spacing: -0.5px;
        }

        .logo-section p {
            font-size: 13px;
            color: rgba(255,255,255,0.8);
            font-weight: 500;
        }

        .model-badge {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            color: #fff;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            border: 1px solid rgba(255,255,255,0.2);
        }

        /* Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 32px 24px;
        }

        /* Filters Card */
        .filters-card {
            background: #fff;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            border: 1px solid #e5e1d7;
        }

        .filters-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .filter-group label {
            display: block;
            font-weight: 600;
            font-size: 13px;
            color: #4a4a4a;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .input-field, .select-field {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e1d7;
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            background: #fafaf8;
            transition: all 0.2s;
            color: #2c2c2c;
        }

            .input-field:focus, .select-field:focus {
                outline: none;
                border-color: #2563eb;
                background: #fff;
                box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
            }

        /* Table Card */
        .table-card {
            background: #fff;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            border: 1px solid #e5e1d7;
        }

        .table-header {
            background: linear-gradient(to right, #f5f1e8 0%, #e8e4d9 100%);
            padding: 16px 24px;
            border-bottom: 2px solid #d4cfc0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-title {
            font-size: 18px;
            font-weight: 700;
            color: #1e3a8a;
        }

        .table-info {
            font-size: 12px;
            color: #6b6b6b;
            font-weight: 500;
        }

        .table-container {
            overflow-x: auto;
            max-height: 600px;
            overflow-y: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 900px;
        }

        /* Table Head */
        thead {
            position: sticky;
            top: 0;
            z-index: 100;
        }

            thead th {
                background: linear-gradient(to bottom, #1e3a8a 0%, #1e40af 100%);
                color: #fff;
                padding: 14px 16px;
                text-align: left;
                font-size: 12px;
                font-weight: 700;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                border-bottom: 3px solid #2563eb;
            }

                thead th.text-center {
                    text-align: center;
                }

                thead th.proj-col {
                    background: linear-gradient(to bottom, #2563eb 0%, #3b82f6 100%);
                }

        /* Table Body */
        tbody tr {
            border-bottom: 1px solid #f0ede3;
            transition: all 0.2s ease;
            cursor: pointer;
        }

            tbody tr:hover {
                background: #fafaf8;
            }

            tbody tr.selected {
                background: linear-gradient(90deg, #dbeafe 0%, #bfdbfe 100%);
                border-left: 4px solid #2563eb;
            }

            tbody tr.dimmed {
                opacity: 0.25;
                pointer-events: none;
            }

        tbody td {
            padding: 16px;
            color: #2c2c2c;
            font-size: 14px;
        }

        .player-cell {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .player-rank {
            background: #1e3a8a;
            color: #fff;
            width: 32px;
            height: 32px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 700;
            flex-shrink: 0;
        }

        .player-name {
            font-weight: 700;
            color: #1e3a8a;
            font-size: 15px;
        }

        .team-cell {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .team-logo {
            width: 24px;
            height: 24px;
            object-fit: contain;
        }

        .team-abbr {
            font-weight: 600;
            color: #4a4a4a;
        }

        .proj-value {
            text-align: center;
            font-weight: 900;
            font-size: 17px;
            color: #2563eb;
        }

        .avg-value {
            text-align: center;
            color: #6b6b6b;
            font-size: 14px;
        }

        /* Footer Bar */
        .table-footer {
            background: #fafaf8;
            padding: 12px 24px;
            border-top: 1px solid #e5e1d7;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: #6b6b6b;
        }

            .table-footer strong {
                color: #1e3a8a;
                font-weight: 700;
            }

        /* Modal Overlay */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            padding: 20px;
        }

            .modal-overlay.active {
                opacity: 1;
                pointer-events: all;
            }

        /* Modal */
        .modal {
            background: #fff;
            border-radius: 16px;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            transform: scale(0.9) translateY(20px);
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .modal-overlay.active .modal {
            transform: scale(1) translateY(0);
        }

        .modal-header {
            background: linear-gradient(135deg, #1e3a8a 0%, #2563eb 100%);
            padding: 20px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            color: #fff;
            font-size: 18px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .modal-close {
            background: rgba(255,255,255,0.2);
            border: none;
            color: #fff;
            width: 36px;
            height: 36px;
            border-radius: 8px;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            font-weight: 300;
        }

            .modal-close:hover {
                background: rgba(255,255,255,0.3);
                transform: rotate(90deg);
            }

        .modal-body {
            padding: 24px;
            max-height: calc(90vh - 80px);
            overflow-y: auto;
        }

        /* Player Card */
        .player-card {
            background: linear-gradient(135deg, #fafaf8 0%, #f5f1e8 100%);
            border: 1px solid #e5e1d7;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            transition: all 0.2s ease;
        }

            .player-card:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(30, 58, 138, 0.1);
                border-color: #2563eb;
            }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid #e5e1d7;
        }

        .card-player-name {
            font-weight: 700;
            font-size: 16px;
            color: #1e3a8a;
        }

        .card-team-badge {
            background: #2563eb;
            color: #fff;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 700;
        }

        .card-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .card-stat {
            text-align: center;
            background: #fff;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #e5e1d7;
        }

        .card-stat-label {
            font-size: 11px;
            color: #6b6b6b;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .card-stat-value {
            font-size: 20px;
            font-weight: 900;
            color: #2563eb;
        }

        /* Error Alert */
        .error-alert {
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-left: 4px solid #ef4444;
            color: #991b1b;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 24px;
            font-weight: 500;
        }

            .error-alert strong {
                font-weight: 700;
            }

        /* Scrollbar */
        .table-container::-webkit-scrollbar,
        .modal-body::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        .table-container::-webkit-scrollbar-track,
        .modal-body::-webkit-scrollbar-track {
            background: #f5f1e8;
        }

        .table-container::-webkit-scrollbar-thumb,
        .modal-body::-webkit-scrollbar-thumb {
            background: #2563eb;
            border-radius: 5px;
        }

            .table-container::-webkit-scrollbar-thumb:hover,
            .modal-body::-webkit-scrollbar-thumb:hover {
                background: #1e40af;
            }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 16px;
                text-align: center;
            }

            .filters-grid {
                grid-template-columns: 1fr;
            }

            .modal {
                max-width: 100%;
                margin: 0 10px;
            }

            table {
                font-size: 12px;
            }

            tbody td {
                padding: 12px 8px;
            }
        }
    </style>
</head>
<body>

    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <div class="logo-section">
                <h1>NBA Player Stats Projections</h1>
                <p>Sports Data Analytics </p>
            </div>
            <div class="model-badge">
                Ranger v2.0 Active
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container">

        {% if error %}
        <div class="error-alert">
            <strong>⚠️ Error:</strong> {{ error }}
        </div>
        {% endif %}

        <!-- Filters -->
        <div class="filters-card">
            <div class="filters-grid">
                <div class="filter-group">
                    <label for="searchInput">🔍 Search Player</label>
                    <input type="text" id="searchInput" class="input-field" placeholder="Enter player name...">
                </div>
                <div class="filter-group">
                    <label for="matchupSelect">🏆 Filter Matchup</label>
                    <select id="matchupSelect" class="select-field">
                        <option value="All">All Games</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Table -->
        <div class="table-card">
            <div class="table-header">
                <div class="table-title">Today's Projections</div>
                <div class="table-info">Click any player for matchup details</div>
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th style="min-width: 200px;">Player</th>
                            <th class="text-center" style="min-width: 100px;">Team</th>
                            <th class="text-center" style="min-width: 100px;">Opponent</th>
                            <th class="text-center proj-col">Proj PTS</th>
                            <th class="text-center">L5 Avg</th>
                            <th class="text-center proj-col">Proj REB</th>
                            <th class="text-center">L5 Avg</th>
                            <th class="text-center proj-col">Proj AST</th>
                            <th class="text-center">L5 Avg</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        {% for p in projections %}
                        <tr data-player="{{ p.athlete_display_name }}" data-team="{{ p.team_abbreviation }}" data-opp="{{ p.opponent }}" data-pts="{{ p.Proj_PTS }}" data-reb="{{ p.Proj_REB }}" data-ast="{{ p.Proj_AST }}">
                            <td>
                                <div class="player-cell">
                                    <div class="player-rank">#{{ loop.index }}</div>
                                    <div class="player-name">{{ p.athlete_display_name }}</div>
                                </div>
                            </td>
                            <td>
                                <div class="team-cell">
                                    <img src="https://cdn.nba.com/logos/nba/{{ p.team_abbreviation }}/primary/L/logo.svg" class="team-logo" alt="{{ p.team_abbreviation }}" onerror="this.style.display='none'">
                                    <span class="team-abbr">{{ p.team_abbreviation }}</span>
                                </div>
                            </td>
                            <td>
                                <div class="team-cell">
                                    <img src="https://cdn.nba.com/logos/nba/{{ p.opponent }}/primary/L/logo.svg" class="team-logo" alt="{{ p.opponent }}" onerror="this.style.display='none'">
                                    <span class="team-abbr">{{ p.opponent }}</span>
                                </div>
                            </td>
                            <td class="proj-value">{{ p.Proj_PTS }}</td>
                            <td class="avg-value">{{ p.L5_PTS }}</td>
                            <td class="proj-value">{{ p.Proj_REB }}</td>
                            <td class="avg-value">{{ p.L5_REB }}</td>
                            <td class="proj-value">{{ p.Proj_AST }}</td>
                            <td class="avg-value">{{ p.L5_AST }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <div class="table-footer">
                <div>
                    Showing <strong id="recordCount">0</strong> players
                </div>
                <div>
                    Last Updated: <strong>{{ year }}</strong> | Powered by HoopR & Random Forest
                </div>
            </div>
        </div>

    </div>

    <!-- Modal Overlay -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">🎯 Same Matchup Players</div>
                <button class="modal-close" onclick="toggleModal()">×</button>
            </div>
            <div class="modal-body" id="modalBody">
                <div style="text-align: center; color: #6b6b6b; padding: 40px;">
                    Click on any player to view matchup details
                </div>
            </div>
        </div>
    </div>

    <script>
        const tbody = document.getElementById("tableBody");
        const rows = Array.from(tbody.getElementsByTagName("tr"));
        const searchInput = document.getElementById("searchInput");
        const matchupSelect = document.getElementById("matchupSelect");
        const modalOverlay = document.getElementById("modalOverlay");
        const modalBody = document.getElementById("modalBody");
        const recordCount = document.getElementById("recordCount");

        let currentSelectedRow = null;

        // Populate matchup dropdown
        const uniqueMatchups = new Set();
        rows.forEach(row => {
            const team = row.dataset.team;
            const opp = row.dataset.opp;
            if (team && opp) {
                // Create sorted matchup key to avoid duplicates
                const sortedTeams = [team, opp].sort();
                const matchupKey = `${sortedTeams[0]} vs ${sortedTeams[1]}`;
                uniqueMatchups.add(matchupKey);
            }
        });

        Array.from(uniqueMatchups).sort().forEach(match => {
            const option = document.createElement("option");
            option.value = match;
            option.textContent = match;
            matchupSelect.appendChild(option);
        });;

        // Filter function
        function filterTable() {
            const searchText = searchInput.value.toLowerCase();
            const selectedMatchup = matchupSelect.value;
            let visibleCount = 0;

            rows.forEach(row => {
                const name = (row.dataset.player || "").toLowerCase();
                const team = row.dataset.team || "";
                const opp = row.dataset.opp || "";

                // Create sorted matchup for comparison
                const sortedTeams = [team, opp].sort();
                const currentMatchup = `${sortedTeams[0]} vs ${sortedTeams[1]}`;

                const matchesName = name.includes(searchText);
                const matchesMatchup = (selectedMatchup === "All") || (currentMatchup === selectedMatchup);

                if (matchesName && matchesMatchup) {
                    row.style.display = "";
                    visibleCount++;
                } else {
                    row.style.display = "none";
                }
            });

            recordCount.textContent = visibleCount;
        }

        searchInput.addEventListener("keyup", filterTable);
        matchupSelect.addEventListener("change", filterTable);

        // Click on row to toggle selection and modal
        rows.forEach(row => {
            row.addEventListener("click", function (e) {
                // If clicking the same row, toggle off
                if (currentSelectedRow === this) {
                    toggleModal();
                    return;
                }

                // Remove previous selection
                if (currentSelectedRow) {
                    currentSelectedRow.classList.remove("selected");
                }
                rows.forEach(r => r.classList.remove("dimmed"));

                // Select new row
                this.classList.add("selected");
                currentSelectedRow = this;

                // Dim other rows
                rows.forEach(r => {
                    if (r !== this && r.style.display !== "none") {
                        r.classList.add("dimmed");
                    }
                });

                // Show modal
                showModal(this);
            });
        });

        function showModal(clickedRow) {
            const team = clickedRow.dataset.team;
            const opp = clickedRow.dataset.opp;
            const clickedPlayer = clickedRow.dataset.player;

            // Find players from same matchup
            const matchupPlayers = rows.filter(row => {
                const rowTeam = row.dataset.team;
                const rowOpp = row.dataset.opp;
                const rowPlayer = row.dataset.player;
                return (rowTeam === team || rowTeam === opp) &&
                    (rowOpp === team || rowOpp === opp) &&
                    rowPlayer !== clickedPlayer &&
                    row.style.display !== "none";
            });

            // Build modal HTML
            modalBody.innerHTML = "";

            if (matchupPlayers.length === 0) {
                modalBody.innerHTML = "<div style='text-align: center; color: #6b6b6b; padding: 40px;'>No other players in this matchup</div>";
            } else {
                matchupPlayers.slice(0, 10).forEach(row => {
                    const div = document.createElement("div");
                    div.className = "player-card";
                    div.innerHTML = `
                            <div class="card-header">
                                <div class="card-player-name">${row.dataset.player}</div>
                                <div class="card-team-badge">${row.dataset.team}</div>
                            </div>
                            <div class="card-stats">
                                <div class="card-stat">
                                    <div class="card-stat-label">Points</div>
                                    <div class="card-stat-value">${row.dataset.pts}</div>
                                </div>
                                <div class="card-stat">
                                    <div class="card-stat-label">Rebounds</div>
                                    <div class="card-stat-value">${row.dataset.reb}</div>
                                </div>
                                <div class="card-stat">
                                    <div class="card-stat-label">Assists</div>
                                    <div class="card-stat-value">${row.dataset.ast}</div>
                                </div>
                            </div>
                        `;
                    modalBody.appendChild(div);
                });
            }

            // Show modal with animation
            modalOverlay.classList.add("active");
        }

        function toggleModal() {
            const isActive = modalOverlay.classList.contains("active");

            if (isActive) {
                // Close modal
                modalOverlay.classList.remove("active");
                if (currentSelectedRow) {
                    currentSelectedRow.classList.remove("selected");
                    currentSelectedRow = null;
                }
                rows.forEach(r => r.classList.remove("dimmed"));
            }
        }

        // Close modal when clicking outside
        modalOverlay.addEventListener("click", function (e) {
            if (e.target === modalOverlay) {
                toggleModal();
            }
        });

        // Close modal with Escape key
        document.addEventListener("keydown", function (e) {
            if (e.key === "Escape" && modalOverlay.classList.contains("active")) {
                toggleModal();
            }
        });

        // Initial count
        filterTable();
    </script>
</body>
</html>